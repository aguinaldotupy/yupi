var ie=Object.defineProperty,re=Object.defineProperties;var oe=Object.getOwnPropertyDescriptors;var E=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable;var D=(e,t,d)=>t in e?ie(e,t,{enumerable:!0,configurable:!0,writable:!0,value:d}):e[t]=d,P=(e,t)=>{for(var d in t||(t={}))ae.call(t,d)&&D(e,d,t[d]);if(E)for(var d of E(t))le.call(t,d)&&D(e,d,t[d]);return e},O=(e,t)=>re(e,oe(t));import{e as x,r as se,c as q,w as A,Z as ce,z as g,A as y,B as G,J as v,C as r,u as n,M as T,K as u,O as _,N as C,F as H,P as ue,L as de,a1 as ge}from"./vendor.8df7962f.js";import{o as z,a6 as J,l as ve,O as me,j as fe,H as ye,V as be,k as Ie,F as we,u as $e,b as _e,c as Re,d as b,r as S,I as U,x as pe,f as qe}from"./main.9bc4ee1d.js";import{_ as Se,a as Be,b as he,c as Ce,d as Ve,e as Fe,f as Le}from"./SalesTax.493212b8.js";import{_ as Me}from"./ExchangeRateConverter.9df32857.js";import{_ as Te}from"./CreateCustomFields.d6a6f52a.js";import{_ as Ne}from"./TaxTypeModal.616812f0.js";import"./DragIcon.28f4c02c.js";import"./SelectNotePopup.320322dc.js";import"./NoteModal.43dc9858.js";import"./payment.f901da8c.js";import"./exchange-rate.5607b5c0.js";const ke={class:"col-span-5 pr-0"},xe={class:"flex mt-7"},Ue={class:"relative w-20 mt-8"},je={class:"ml-2"},Ee={class:"p-0 mb-1 leading-snug text-left text-black"},De={class:"p-0 m-0 text-xs leading-tight text-left text-gray-500",style:{"max-width":"480px"}},Pe={class:"grid grid-cols-1 col-span-7 gap-4 mt-8 lg:gap-6 lg:mt-0 lg:grid-cols-2"},Oe={props:{v:{type:Object,default:null},isLoading:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1}},setup(e){const t=e,d=z(),i=J(),F=ve(),R=x(!1),N=se([{label:"None",value:"NONE"},{label:"Date",value:"DATE"},{label:"Count",value:"COUNT"}]),B=q(()=>i.newRecurringInvoice.selectedFrequency&&i.newRecurringInvoice.selectedFrequency.value==="CUSTOM"),k=q(()=>t.isEdit?F.config.recurring_invoice_status.update_status:F.config.recurring_invoice_status.create_status);A(()=>i.newRecurringInvoice.selectedFrequency,a=>{i.isFetchingInitialSettings||(a&&a.value!=="CUSTOM"?i.newRecurringInvoice.frequency=a.value:i.newRecurringInvoice.frequency=null)}),ce(()=>{d.params.id||h()});function c(a){return i.newRecurringInvoice.limit_by===a}const m=me(()=>{h()},500);async function h(){const a=i.newRecurringInvoice.frequency;if(!a)return;R.value=!0;let o={starts_at:i.newRecurringInvoice.starts_at,frequency:a};try{await i.fetchRecurringInvoiceFrequencyDate(o)}catch(I){console.error(I),R.value=!1}R.value=!1}return(a,o)=>{const I=g("BaseCustomerSelectPopup"),L=g("BaseSwitch"),w=g("BaseDatePicker"),f=g("BaseInputGroup"),V=g("BaseMultiselect"),p=g("BaseInput");return y(),G(H,null,[v("div",ke,[r(I,{modelValue:n(i).newRecurringInvoice.customer,"onUpdate:modelValue":o[0]||(o[0]=l=>n(i).newRecurringInvoice.customer=l),valid:e.v.customer_id,"content-loading":e.isLoading,type:"recurring-invoice"},null,8,["modelValue","valid","content-loading"]),v("div",xe,[v("div",Ue,[r(L,{modelValue:n(i).newRecurringInvoice.send_automatically,"onUpdate:modelValue":o[1]||(o[1]=l=>n(i).newRecurringInvoice.send_automatically=l),class:"absolute -top-4"},null,8,["modelValue"])]),v("div",je,[v("p",Ee,T(a.$t("recurring_invoices.send_automatically")),1),v("p",De,T(a.$t("recurring_invoices.send_automatically_desc")),1)])])]),v("div",Pe,[r(f,{label:a.$t("recurring_invoices.starts_at"),"content-loading":e.isLoading,required:"",error:e.v.starts_at.$error&&e.v.starts_at.$errors[0].$message},{default:u(()=>[r(w,{modelValue:n(i).newRecurringInvoice.starts_at,"onUpdate:modelValue":o[2]||(o[2]=l=>n(i).newRecurringInvoice.starts_at=l),"content-loading":e.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar",invalid:e.v.starts_at.$error,onChange:o[3]||(o[3]=l=>h())},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","error"]),r(f,{label:a.$t("recurring_invoices.next_invoice_date"),"content-loading":e.isLoading,required:""},{default:u(()=>[r(w,{modelValue:n(i).newRecurringInvoice.next_invoice_at,"onUpdate:modelValue":o[4]||(o[4]=l=>n(i).newRecurringInvoice.next_invoice_at=l),"content-loading":e.isLoading,"calendar-button":!0,disabled:!0,loading:R.value,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading","loading"])]),_:1},8,["label","content-loading"]),r(f,{label:a.$t("recurring_invoices.limit_by"),"content-loading":e.isLoading,class:"lg:mt-0",required:"",error:e.v.limit_by.$error&&e.v.limit_by.$errors[0].$message},{default:u(()=>[r(V,{modelValue:n(i).newRecurringInvoice.limit_by,"onUpdate:modelValue":o[5]||(o[5]=l=>n(i).newRecurringInvoice.limit_by=l),"content-loading":e.isLoading,options:n(N),label:"label",invalid:e.v.limit_by.$error,"value-prop":"value"},null,8,["modelValue","content-loading","options","invalid"])]),_:1},8,["label","content-loading","error"]),c("DATE")?(y(),_(f,{key:0,label:a.$t("recurring_invoices.limit_date"),"content-loading":e.isLoading,required:c("DATE"),error:e.v.limit_date.$error&&e.v.limit_date.$errors[0].$message},{default:u(()=>[r(w,{modelValue:n(i).newRecurringInvoice.limit_date,"onUpdate:modelValue":o[6]||(o[6]=l=>n(i).newRecurringInvoice.limit_date=l),"content-loading":e.isLoading,invalid:e.v.limit_date.$error,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","required","error"])):C("",!0),c("COUNT")?(y(),_(f,{key:1,label:a.$t("recurring_invoices.count"),"content-loading":e.isLoading,required:c("COUNT"),error:e.v.limit_count.$error&&e.v.limit_count.$errors[0].$message},{default:u(()=>[r(p,{modelValue:n(i).newRecurringInvoice.limit_count,"onUpdate:modelValue":o[7]||(o[7]=l=>n(i).newRecurringInvoice.limit_count=l),"content-loading":e.isLoading,invalid:e.v.limit_count.$error,type:"number"},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","required","error"])):C("",!0),r(f,{label:a.$t("recurring_invoices.status"),required:"","content-loading":e.isLoading,error:e.v.status.$error&&e.v.status.$errors[0].$message},{default:u(()=>[r(V,{modelValue:n(i).newRecurringInvoice.status,"onUpdate:modelValue":o[8]||(o[8]=l=>n(i).newRecurringInvoice.status=l),options:n(k),"content-loading":e.isLoading,invalid:e.v.status.$error,placeholder:a.$t("recurring_invoices.select_a_status"),"value-prop":"value",label:"value"},null,8,["modelValue","options","content-loading","invalid","placeholder"])]),_:1},8,["label","content-loading","error"]),r(f,{label:a.$t("recurring_invoices.frequency.select_frequency"),required:"","content-loading":e.isLoading,error:e.v.selectedFrequency.$error&&e.v.selectedFrequency.$errors[0].$message},{default:u(()=>[r(V,{modelValue:n(i).newRecurringInvoice.selectedFrequency,"onUpdate:modelValue":o[9]||(o[9]=l=>n(i).newRecurringInvoice.selectedFrequency=l),"content-loading":e.isLoading,options:n(i).frequencies,label:"label",invalid:e.v.selectedFrequency.$error,object:"",onChange:h},null,8,["modelValue","content-loading","options","invalid"])]),_:1},8,["label","content-loading","error"]),n(B)?(y(),_(f,{key:2,label:a.$t("recurring_invoices.frequency.title"),"content-loading":e.isLoading,required:"",error:e.v.frequency.$error&&e.v.frequency.$errors[0].$message},{default:u(()=>[r(p,{modelValue:n(i).newRecurringInvoice.frequency,"onUpdate:modelValue":[o[10]||(o[10]=l=>n(i).newRecurringInvoice.frequency=l),n(m)],"content-loading":e.isLoading,disabled:!n(B),invalid:e.v.frequency.$error,loading:R.value},null,8,["modelValue","content-loading","disabled","invalid","loading","onUpdate:modelValue"])]),_:1},8,["label","content-loading","error"])):C("",!0),r(Me,{store:n(i),"store-prop":"newRecurringInvoice",v:e.v,"is-loading":e.isLoading,"is-edit":e.isEdit,"customer-currency":n(i).newRecurringInvoice.currency_id},null,8,["store","v","is-loading","is-edit","customer-currency"])])],64)}}},Ae=["onSubmit"],Ge={class:"flex"},He={class:"grid-cols-12 gap-8 mt-6 mb-8 lg:grid"},ze={class:"block mt-10 invoice-foot lg:flex lg:justify-between lg:items-start"},Je={class:"w-full relative lg:w-1/2"},ln={setup(e){const t=J(),d=fe(),i=ye(),F=be(),R=Ie(),N=we(),B="newRecurringInvoice",k=$e(),{t:c}=_e();let m=x(!1);const h=x(["customer","company","customerCustom","invoice","invoiceCustom"]);let a=z(),o=Re(),I=q(()=>t.isFetchingInvoice||t.isFetchingInitialSettings),L=q(()=>w.value?c("recurring_invoices.edit_invoice"):c("recurring_invoices.new_invoice")),w=q(()=>a.name==="recurring-invoices.edit");const f=q(()=>d.selectedCompanySettings.sales_tax_us_enabled==="YES"&&F.salesTaxUSEnabled),V={starts_at:{required:b.withMessage(c("validation.required"),S)},status:{required:b.withMessage(c("validation.required"),S)},frequency:{required:b.withMessage(c("validation.required"),S)},limit_by:{required:b.withMessage(c("validation.required"),S)},limit_date:{required:b.withMessage(c("validation.required"),U(function(){return t.newRecurringInvoice.limit_by==="DATE"}))},limit_count:{required:b.withMessage(c("validation.required"),U(function(){return t.newRecurringInvoice.limit_by==="COUNT"}))},selectedFrequency:{required:b.withMessage(c("validation.required"),S)},customer_id:{required:b.withMessage(c("validation.required"),S)},exchange_rate:{required:U(function(){return b.withMessage(c("validation.required"),S),t.showExchangeRate}),decimal:b.withMessage(c("validation.valid_exchange_rate"),pe)}},p=qe(V,q(()=>t.newRecurringInvoice),{$scope:B});t.resetCurrentRecurringInvoice(),t.fetchRecurringInvoiceInitialSettings(w.value),i.resetCustomFields(),p.value.$reset,A(()=>t.newRecurringInvoice.customer,s=>{s&&s.currency?t.newRecurringInvoice.currency=s.currency:t.newRecurringInvoice.currency=d.selectedCompanyCurrency});async function l(){if(p.value.$touch(),p.value.$invalid)return!1;m.value=!0;let s=O(P({},t.newRecurringInvoice),{sub_total:t.getSubTotal,total:t.getTotal,tax:t.getTotalTax});if(s.customer&&!s.customer.email&&s.send_automatically){k.showNotification({type:"error",message:c("recurring_invoices.add_customer_email")}),K(),m.value=!1;return}a.params.id?t.updateRecurringInvoice(s).then($=>{$.data.data&&o.push(`/admin/recurring-invoices/${$.data.data.id}/view`),m.value=!1}).catch($=>{m.value=!1}):Y(s)}async function K(){let s=t.newRecurringInvoice.customer.id;await N.fetchCustomer(s),R.openModal({title:c("customers.edit_customer"),componentName:"CustomerModal"})}function Y(s){t.addRecurringInvoice(s).then($=>{$.data.data&&o.push(`/admin/recurring-invoices/${$.data.data.id}/view`),m.value=!1}).catch($=>{m.value=!1})}return(s,$)=>{const M=g("BaseBreadcrumbItem"),Z=g("BaseBreadcrumb"),j=g("BaseButton"),Q=g("router-link"),W=g("BaseIcon"),X=g("BasePageHeader"),ee=g("BaseScrollPane"),ne=g("BasePage");return y(),G(H,null,[r(Se),r(Be),r(Ne),n(f)&&!n(I)?(y(),_(he,{key:0,store:n(t),"store-prop":"newRecurringInvoice","is-edit":n(w),customer:n(t).newRecurringInvoice.customer},null,8,["store","is-edit","customer"])):C("",!0),r(ne,{class:"relative invoice-create-page"},{default:u(()=>[v("form",{onSubmit:ge(l,["prevent"])},[r(X,{title:n(L)},{actions:u(()=>[r(Q,{to:`/invoices/pdf/${n(t).newRecurringInvoice.unique_hash}`},{default:u(()=>[s.$route.name==="invoices.edit"?(y(),_(j,{key:0,target:"_blank",class:"mr-3",variant:"primary-outline",type:"button"},{default:u(()=>[v("span",Ge,T(s.$t("general.view_pdf")),1)]),_:1})):C("",!0)]),_:1},8,["to"]),r(j,{loading:n(m),disabled:n(m),variant:"primary",type:"submit"},{left:u(te=>[n(m)?C("",!0):(y(),_(W,{key:0,name:"SaveIcon",class:ue(te.class)},null,8,["class"]))]),default:u(()=>[de(" "+T(s.$t("recurring_invoices.save_invoice")),1)]),_:1},8,["loading","disabled"])]),default:u(()=>[r(Z,null,{default:u(()=>[r(M,{title:s.$t("general.home"),to:"/admin/dashboard"},null,8,["title"]),r(M,{title:s.$t("recurring_invoices.title",2),to:"/admin/recurring-invoices"},null,8,["title"]),s.$route.name==="invoices.edit"?(y(),_(M,{key:0,title:s.$t("recurring_invoices.edit_invoice"),to:"#",active:""},null,8,["title"])):(y(),_(M,{key:1,title:n(L),to:"#",active:""},null,8,["title"]))]),_:1})]),_:1},8,["title"]),v("div",He,[r(Oe,{v:n(p),"is-loading":n(I),"is-edit":n(w)},null,8,["v","is-loading","is-edit"])]),r(ee,null,{default:u(()=>[r(Ce,{currency:n(t).newRecurringInvoice.currency,"is-loading":n(I),"item-validation-scope":B,store:n(t),"store-prop":"newRecurringInvoice"},null,8,["currency","is-loading","store"]),v("div",ze,[v("div",Je,[r(Ve,{store:n(t),"store-prop":"newRecurringInvoice",fields:h.value,type:"Invoice"},null,8,["store","fields"]),r(Te,{type:"Invoice","is-edit":n(w),"is-loading":n(I),store:n(t),"store-prop":"newRecurringInvoice","custom-field-scope":B,class:"mb-6"},null,8,["is-edit","is-loading","store"]),r(Fe,{store:n(t),"store-prop":"newRecurringInvoice"},null,8,["store"])]),r(Le,{currency:n(t).newRecurringInvoice.currency,"is-loading":n(I),store:n(t),"store-prop":"newRecurringInvoice","tax-popup-type":"invoice"},null,8,["currency","is-loading","store"])])]),_:1})],40,Ae)]),_:1})],64)}}};export{ln as default};
