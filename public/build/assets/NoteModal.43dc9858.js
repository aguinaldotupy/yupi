var J=Object.defineProperty;var q=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var x=(d,s,a)=>s in d?J(d,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):d[s]=a,z=(d,s)=>{for(var a in s||(s={}))K.call(s,a)&&x(d,a,s[a]);if(q)for(var a of q(s))R.call(s,a)&&x(d,a,s[a]);return d};import{e as j,r as X,c as S,w as Z,Z as H,z as f,A as Q,O as W,K as p,J as w,L as b,M as C,u as o,C as c,P as Y,a1 as ee}from"./vendor.8df7962f.js";import{g,y as $,z as te,k as ae,u as oe,B as ne,E as se,o as re,b as ie,d as I,r as M,m as ue,f as le}from"./main.9bc4ee1d.js";import{u as ce}from"./payment.f901da8c.js";const de=(d=!1)=>(d?window.pinia.defineStore:te)({id:"notes",state:()=>({notes:[],currentNote:{id:null,type:"",name:"",notes:""}}),getters:{isEdit:a=>!!a.currentNote.id},actions:{resetCurrentNote(){this.currentNote={type:"",name:"",notes:""}},fetchNotes(a){return new Promise((e,l)=>{g.get("/api/v1/notes",{params:a}).then(t=>{this.notes=t.data.data,e(t)}).catch(t=>{$(t),l(t)})})},fetchNote(a){return new Promise((e,l)=>{g.get(`/api/v1/notes/${a}`).then(t=>{this.currentNote=t.data.data,e(t)}).catch(t=>{$(t),l(t)})})},addNote(a){return new Promise((e,l)=>{g.post("/api/v1/notes",a).then(t=>{this.notes.push(t.data),e(t)}).catch(t=>{$(t),l(t)})})},updateNote(a){return new Promise((e,l)=>{g.put(`/api/v1/notes/${a.id}`,a).then(t=>{if(t.data){let y=this.notes.findIndex(u=>u.id===t.data.data.id);this.notes[y]=a.notes}e(t)}).catch(t=>{$(t),l(t)})})},deleteNote(a){return new Promise((e,l)=>{g.delete(`/api/v1/notes/${a}`).then(t=>{let y=this.notes.findIndex(u=>u.id===a);this.notes.splice(y,1),e(t)}).catch(t=>{$(t),l(t)})})}}})();const me={class:"flex justify-between w-full"},pe=["onSubmit"],fe={class:"px-8 py-8 sm:p-6"},ve={class:"z-0 flex justify-end px-4 py-4 border-t border-solid border-gray-light"},ge={setup(d){const s=ae(),a=oe(),e=de(),l=ne(),t=ce(),y=se(),u=re(),{t:N}=ie();let v=j(!1);const k=X(["Invoice","Estimate","Payment"]);let h=j(["customer","customerCustom"]);const D=S(()=>s.active&&s.componentName==="NoteModal"),G=S(()=>({currentNote:{name:{required:I.withMessage(N("validation.required"),M),minLength:I.withMessage(N("validation.name_min_length",{count:3}),ue(3))},notes:{required:I.withMessage(N("validation.required"),M)},type:{required:I.withMessage(N("validation.required"),M)}}})),r=le(G,S(()=>e));Z(()=>e.currentNote.type,n=>{V()}),H(()=>{u.name==="estimates.create"?e.currentNote.type="Estimate":u.name==="invoices.create"?e.currentNote.type="Invoice":e.currentNote.type="Payment"});function V(){h.value=["customer","customerCustom"],e.currentNote.type=="Invoice"&&h.value.push("invoice","invoiceCustom"),e.currentNote.type=="Estimate"&&h.value.push("estimate","estimateCustom"),e.currentNote.type=="Payment"&&h.value.push("payment","paymentCustom")}async function F(){if(r.value.currentNote.$touch(),r.value.currentNote.$invalid)return!0;if(v.value=!0,e.isEdit){let n=z({id:e.currentNote.id},e.currentNote);await e.updateNote(n).then(i=>{v.value=!1,i.data&&(a.showNotification({type:"success",message:N("settings.customization.notes.note_updated")}),s.refreshData&&s.refreshData(),_())}).catch(i=>{v.value=!1})}else await e.addNote(e.currentNote).then(n=>{v.value=!1,n.data&&(a.showNotification({type:"success",message:N("settings.customization.notes.note_added")}),(u.name==="invoices.create"&&n.data.data.type==="Invoice"||u.name==="invoices.edit"&&n.data.data.type==="Invoice")&&l.selectNote(n.data.data),(u.name==="estimates.create"&&n.data.data.type==="Estimate"||u.name==="estimates.edit"&&n.data.data.type==="Estimate")&&y.selectNote(n.data.data),(u.name==="payments.create"&&n.data.data.type==="Payment"||u.name==="payments.edit"&&n.data.data.type==="Payment")&&t.selectNote(n.data.data)),s.refreshData&&s.refreshData(),_()}).catch(n=>{v.value=!1})}function _(){s.closeModal(),setTimeout(()=>{e.resetCurrentNote(),r.value.$reset()},300)}return(n,i)=>{const P=f("BaseIcon"),L=f("BaseInput"),B=f("BaseInputGroup"),U=f("BaseMultiselect"),A=f("BaseCustomInput"),O=f("BaseInputGrid"),E=f("BaseButton"),T=f("BaseModal");return Q(),W(T,{show:o(D),onClose:_,onOpen:V},{header:p(()=>[w("div",me,[b(C(o(s).title)+" ",1),c(P,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:_})])]),default:p(()=>[w("form",{action:"",onSubmit:ee(F,["prevent"])},[w("div",fe,[c(O,{layout:"one-column"},{default:p(()=>[c(B,{label:n.$t("settings.customization.notes.name"),variant:"vertical",error:o(r).currentNote.name.$error&&o(r).currentNote.name.$errors[0].$message,required:""},{default:p(()=>[c(L,{modelValue:o(e).currentNote.name,"onUpdate:modelValue":i[0]||(i[0]=m=>o(e).currentNote.name=m),invalid:o(r).currentNote.name.$error,type:"text",onInput:i[1]||(i[1]=m=>o(r).currentNote.name.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),c(B,{label:n.$t("settings.customization.notes.type"),error:o(r).currentNote.type.$error&&o(r).currentNote.type.$errors[0].$message,required:""},{default:p(()=>[c(U,{modelValue:o(e).currentNote.type,"onUpdate:modelValue":i[2]||(i[2]=m=>o(e).currentNote.type=m),options:o(k),"value-prop":"type",class:"mt-2"},null,8,["modelValue","options"])]),_:1},8,["label","error"]),c(B,{label:n.$t("settings.customization.notes.notes"),error:o(r).currentNote.notes.$error&&o(r).currentNote.notes.$errors[0].$message,required:""},{default:p(()=>[c(A,{modelValue:o(e).currentNote.notes,"onUpdate:modelValue":i[3]||(i[3]=m=>o(e).currentNote.notes=m),invalid:o(r).currentNote.notes.$error,fields:o(h),onInput:i[4]||(i[4]=m=>o(r).currentNote.notes.$touch())},null,8,["modelValue","invalid","fields"])]),_:1},8,["label","error"])]),_:1})]),w("div",ve,[c(E,{class:"mr-2",variant:"primary-outline",type:"button",onClick:_},{default:p(()=>[b(C(n.$t("general.cancel")),1)]),_:1}),c(E,{loading:o(v),disabled:o(v),variant:"primary",type:"submit"},{left:p(m=>[c(P,{name:"SaveIcon",class:Y(m.class)},null,8,["class"])]),default:p(()=>[b(" "+C(o(e).isEdit?n.$t("general.update"):n.$t("general.save")),1)]),_:1},8,["loading","disabled"])])],40,pe)]),_:1},8,["show"])}}};export{ge as _,de as u};
