var Y=Object.defineProperty,Q=Object.defineProperties;var W=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var q=(t,e,i)=>e in t?Y(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,L=(t,e)=>{for(var i in e||(e={}))X.call(e,i)&&q(t,i,e[i]);if(j)for(var i of j(e))Z.call(e,i)&&q(t,i,e[i]);return t},x=(t,e)=>Q(t,W(e));import{z as c,A as u,B as M,C as o,u as n,K as l,e as C,c as I,w as ee,O as b,N as k,J as y,M as P,P as ne,L as te,a1 as oe,F as ie}from"./vendor.8df7962f.js";import{B as T,j as ae,H as se,V as ce,b as le,o as re,c as de,d as p,r as B,K as ue,I as me,x as ve,f as ge}from"./main.9bc4ee1d.js";import{_ as pe,a as fe,b as _e,c as Ie,d as be,e as we,f as ye}from"./SalesTax.493212b8.js";import{_ as Be}from"./ExchangeRateConverter.9df32857.js";import{_ as $e}from"./CreateCustomFields.d6a6f52a.js";import{_ as Se}from"./TaxTypeModal.616812f0.js";import"./DragIcon.28f4c02c.js";import"./SelectNotePopup.320322dc.js";import"./NoteModal.43dc9858.js";import"./payment.f901da8c.js";import"./exchange-rate.5607b5c0.js";const he={class:"grid grid-cols-12 gap-8 mt-6 mb-8"},Ce={props:{v:{type:Object,default:null},isLoading:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1}},setup(t){const e=T();return(i,r)=>{const $=c("BaseCustomerSelectPopup"),d=c("BaseDatePicker"),m=c("BaseInputGroup"),S=c("BaseInput"),f=c("BaseInputGrid");return u(),M("div",he,[o($,{modelValue:n(e).newInvoice.customer,"onUpdate:modelValue":r[0]||(r[0]=a=>n(e).newInvoice.customer=a),valid:t.v.customer_id,"content-loading":t.isLoading,type:"invoice",class:"col-span-12 lg:col-span-5 pr-0"},null,8,["modelValue","valid","content-loading"]),o(f,{class:"col-span-12 lg:col-span-7"},{default:l(()=>[o(m,{label:i.$t("invoices.invoice_date"),"content-loading":t.isLoading,required:"",error:t.v.invoice_date.$error&&t.v.invoice_date.$errors[0].$message},{default:l(()=>[o(d,{modelValue:n(e).newInvoice.invoice_date,"onUpdate:modelValue":r[1]||(r[1]=a=>n(e).newInvoice.invoice_date=a),"content-loading":t.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),o(m,{label:i.$t("invoices.due_date"),"content-loading":t.isLoading},{default:l(()=>[o(d,{modelValue:n(e).newInvoice.due_date,"onUpdate:modelValue":r[2]||(r[2]=a=>n(e).newInvoice.due_date=a),"content-loading":t.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading"]),o(m,{label:i.$t("invoices.invoice_number"),"content-loading":t.isLoading,error:t.v.invoice_number.$error&&t.v.invoice_number.$errors[0].$message,required:""},{default:l(()=>[o(S,{modelValue:n(e).newInvoice.invoice_number,"onUpdate:modelValue":r[3]||(r[3]=a=>n(e).newInvoice.invoice_number=a),"content-loading":t.isLoading,onInput:r[4]||(r[4]=a=>t.v.invoice_number.$touch())},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),o(Be,{store:n(e),"store-prop":"newInvoice",v:t.v,"is-loading":t.isLoading,"is-edit":t.isEdit,"customer-currency":n(e).newInvoice.currency_id},null,8,["store","v","is-loading","is-edit","customer-currency"])]),_:1})])}}},ke=["onSubmit"],Ve={class:"flex"},je={class:"block mt-10 invoice-foot lg:flex lg:justify-between lg:items-start"},qe={class:"relative w-full lg:w-1/2 lg:mr-4"},He={setup(t){const e=T(),i=ae(),r=se(),$=ce(),{t:d}=le();let m=re(),S=de();const f="newInvoice";let a=C(!1);const F=C(!1),E=C(["customer","company","customerCustom","invoice","invoiceCustom"]);let _=I(()=>e.isFetchingInvoice||e.isFetchingInitialSettings),N=I(()=>v.value?d("invoices.edit_invoice"):d("invoices.new_invoice"));const D=I(()=>i.selectedCompanySettings.sales_tax_us_enabled==="YES"&&$.salesTaxUSEnabled);let v=I(()=>m.name==="invoices.edit");const U={invoice_date:{required:p.withMessage(d("validation.required"),B)},reference_number:{maxLength:p.withMessage(d("validation.price_maxlength"),ue(255))},customer_id:{required:p.withMessage(d("validation.required"),B)},invoice_number:{required:p.withMessage(d("validation.required"),B)},exchange_rate:{required:me(function(){return p.withMessage(d("validation.required"),B),e.showExchangeRate}),decimal:p.withMessage(d("validation.valid_exchange_rate"),ve)}},w=ge(U,I(()=>e.newInvoice),{$scope:f});r.resetCustomFields(),w.value.$reset,e.resetCurrentInvoice(),e.fetchInvoiceInitialSettings(v.value),ee(()=>e.newInvoice.customer,s=>{s&&s.currency?e.newInvoice.selectedCurrency=s.currency:e.newInvoice.selectedCurrency=i.selectedCompanyCurrency});async function G(){if(w.value.$touch(),w.value.$invalid)return!1;a.value=!0;let s=x(L({},e.newInvoice),{sub_total:e.getSubTotal,total:e.getTotal,tax:e.getTotalTax});try{const g=await(v.value?e.updateInvoice:e.addInvoice)(s);S.push(`/admin/invoices/${g.data.data.id}/view`)}catch(h){console.error(h)}a.value=!1}return(s,h)=>{const g=c("BaseBreadcrumbItem"),R=c("BaseBreadcrumb"),V=c("BaseButton"),H=c("router-link"),z=c("BaseIcon"),A=c("BasePageHeader"),K=c("BaseScrollPane"),O=c("BasePage");return u(),M(ie,null,[o(pe),o(fe),o(Se),n(D)&&(!n(_)||n(m).query.customer)?(u(),b(_e,{key:0,store:n(e),"is-edit":n(v),"store-prop":"newInvoice",customer:n(e).newInvoice.customer},null,8,["store","is-edit","customer"])):k("",!0),o(O,{class:"relative invoice-create-page"},{default:l(()=>[y("form",{onSubmit:oe(G,["prevent"])},[o(A,{title:n(N)},{actions:l(()=>[s.$route.name==="invoices.edit"?(u(),b(H,{key:0,to:`/invoices/pdf/${n(e).newInvoice.unique_hash}`,target:"_blank"},{default:l(()=>[o(V,{class:"mr-3",variant:"primary-outline",type:"button"},{default:l(()=>[y("span",Ve,P(s.$t("general.view_pdf")),1)]),_:1})]),_:1},8,["to"])):k("",!0),o(V,{loading:n(a),disabled:n(a),variant:"primary",type:"submit"},{left:l(J=>[n(a)?k("",!0):(u(),b(z,{key:0,name:"SaveIcon",class:ne(J.class)},null,8,["class"]))]),default:l(()=>[te(" "+P(s.$t("invoices.save_invoice")),1)]),_:1},8,["loading","disabled"])]),default:l(()=>[o(R,null,{default:l(()=>[o(g,{title:s.$t("general.home"),to:"/admin/dashboard"},null,8,["title"]),o(g,{title:s.$tc("invoices.invoice",2),to:"/admin/invoices"},null,8,["title"]),s.$route.name==="invoices.edit"?(u(),b(g,{key:0,title:s.$t("invoices.edit_invoice"),to:"#",active:""},null,8,["title"])):(u(),b(g,{key:1,title:s.$t("invoices.new_invoice"),to:"#",active:""},null,8,["title"]))]),_:1})]),_:1},8,["title"]),o(Ce,{v:n(w),"is-loading":n(_),"is-edit":n(v)},null,8,["v","is-loading","is-edit"]),o(K,null,{default:l(()=>[o(Ie,{currency:n(e).newInvoice.selectedCurrency,"is-loading":n(_),"item-validation-scope":f,store:n(e),"store-prop":"newInvoice"},null,8,["currency","is-loading","store"]),y("div",je,[y("div",qe,[o(be,{store:n(e),"store-prop":"newInvoice",fields:E.value,type:"Invoice"},null,8,["store","fields"]),o($e,{type:"Invoice","is-edit":n(v),"is-loading":n(_),store:n(e),"store-prop":"newInvoice","custom-field-scope":f,class:"mb-6"},null,8,["is-edit","is-loading","store"]),o(we,{store:n(e),"store-prop":"newInvoice","component-name":"InvoiceTemplate","is-mark-as-default":F.value},null,8,["store","is-mark-as-default"])]),o(ye,{currency:n(e).newInvoice.selectedCurrency,"is-loading":n(_),store:n(e),"store-prop":"newInvoice","tax-popup-type":"invoice"},null,8,["currency","is-loading","store"])])]),_:1})],40,ke)]),_:1})],64)}}};export{He as default};
